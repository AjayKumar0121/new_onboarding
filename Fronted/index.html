<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Employee Onboarding</title>
    <style>
        :root {
            --primary-color: #000000;
            --secondary-color: #0900ad;
            --accent-color: #e74c3c;
            --light-gray: #ffffff;
            --dark-gray: #000000;
            --border-color: #949393;
            --success-color: #8a0e81;
            --danger-color: #6b21b0;
        }

        * {
            box-sizing: border-box;
            font-family: 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif;
        }

        body {
            background-color: #ffffff;
            color: #212529;
            line-height: 1.6;
            margin: 0;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: white;
            padding: 30px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.08);
        }

        .header {
            text-align: center;
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 1px solid var(--border-color);
        }

        .header h1 {
            color: var(--primary-color);
            margin-bottom: 10px;
            font-weight: 600;
        }

        .header p {
            color: var(--dark-gray);
            font-size: 1.05rem;
        }

        .form-section {
            margin-bottom: 30px;
            padding: 25px;
            background-color: white;
            border-radius: 6px;
            border: 1px solid var(--border-color);
        }

        .section-title {
            color: var(--primary-color);
            margin-top: 0;
            margin-bottom: 25px;
            font-weight: 600;
            font-size: 1.25rem;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-row {
            display: flex;
            flex-wrap: wrap;
            margin: 0 -10px;
        }

        .form-col {
            flex: 1;
            min-width: 200px;
            padding: 0 10px;
        }

        label {
            display: block;
            margin-bottom: 8px;
            font-weight: 500;
            color: var(--dark-gray);
        }

        .required:after {
            content: " *";
            color: red;
        }

        input[type="text"],
        input[type="email"],
        input[type="tel"],
        input[type="date"],
        input[type="number"],
        input[type="file"],
        select,
        textarea {
            width: 100%;
            padding: 10px 12px;
            border: 1px solid rgb(139, 0, 181);
            box-shadow: 0 0 0 2px rgba(52, 152, 219, 0.2);
            border-radius: 4px;
            font-size: 15px;
            transition: border-color 0.15s ease-in-out, box-shadow 0.15s ease-in-out;
        }

        input:focus, select:focus, textarea:focus {
            outline: none;
            border-color: var(--secondary-color);
            box-shadow: 0 0 0 3px rgba(52, 152, 219, 0.2);
        }

        input[readonly] {
            background-color: #ffffff;
            cursor: not-allowed;
        }

        .radio-group, .checkbox-group {
            display: flex;
            align-items: center;
            margin-bottom: 10px;
        }

        .radio-group label, .checkbox-group label {
            margin: 0 0 0 10px;
            font-weight: normal;
        }

        .radio-group input, .checkbox-group input {
            cursor: pointer;
        }

        .btn {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            color: white;
            border: none;
            padding: 10px 18px;
            font-size: 15px;
            font-weight: 500;
            border-radius: 4px;
            cursor: pointer;
            transition: all 0.2s ease;
            text-align: center;
        }

        .btn:hover {
            transform: translateY(-1px);
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }

        .btn:active {
            transform: translateY(0);
        }

        .btn-block {
            display: block;
            width: 100%;
        }

        .btn-primary {
            background-color: var(--secondary-color);
        }

        .btn-primary:hover {
            background-color: #2980b9;
        }

        .btn-success {
            background-color: var(--success-color);
        }

        .btn-success:hover {
            background-color: #218838;
        }

        .btn-danger {
            background-color: var(--danger-color);
        }

        .btn-danger:hover {
            background-color: #c82333;
        }

        .btn-sm {
            padding: 8px 14px;
            font-size: 14px;
        }

        .experience-item, .education-item, .certification-item {
            background: var(--light-gray);
            padding: 20px;
            margin-bottom: 20px;
            border-radius: 6px;
            border: 1px solid var(--border-color);
            position: relative;
        }

        .document-upload {
            border: 2px dashed var(--border-color);
            padding: 20px;
            text-align: center;
            border-radius: 4px;
            margin-bottom: 10px;
            transition: border-color 0.2s;
        }

        .document-upload:hover {
            border-color: var(--secondary-color);
        }

        .document-upload p {
            margin: 10px 0 0;
            color: #6c757d;
            font-size: 14px;
        }

        .signature-upload {
            border: 1px solid var(--border-color);
            background: white;
            padding: 20px;
            margin-bottom: 10px;
            border-radius: 4px;
        }

        .form-note {
            font-size: 14px;
            color: #6c757d;
            margin-top: 5px;
            font-style: italic;
        }

        .input-banner {
            margin-bottom: 8px;
            font-weight: 500;
            color: var(--dark-gray);
        }

        .current-job-toggle {
            display: flex;
            align-items: center;
            margin-top: 10px;
        }

        .current-job-toggle label {
            margin-left: 8px;
            margin-bottom: 0;
            cursor: pointer;
        }

        .valid {
            border-color: #28a745 !important;
        }

        .invalid {
            border-color: #dc3545 !important;
        }

        .validation-message {
            font-size: 0.8rem;
            color: #dc3545;
            margin-top: 5px;
            display: none;
        }

        .validation-message.visible {
            display: block;
        }

        .checkbox-group.invalid label:after {
            content: " *";
            color: #dc3545;
        }

        @media (max-width: 768px) {
            .form-row {
                flex-direction: column;
            }
            
            .form-col {
                flex: 100%;
                margin-bottom: 15px;
                padding: 0;
            }
            
            .form-section {
                padding: 20px;
            }
        }

        .error-summary {
            background-color: #f8d7da;
            color: #721c24;
            padding: 15px;
            border-radius: 4px;
            margin-bottom: 20px;
            display: none;
        }

        .error-summary.visible {
            display: block;
        }

        .error-summary ul {
            margin: 10px 0 0;
            padding-left: 20px;
        }

        #submitBtn:disabled {
            background-color: #cccccc;
            cursor: not-allowed;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1 style="color: blue;">Employee Onboarding Form</h1>
            <p>Please complete all sections of this form to finalize your onboarding process</p>
        </div>

        <div id="errorSummary" class="error-summary">
            <p>Please correct the following errors:</p>
            <ul id="errorList"></ul>
        </div>

        <form id="onboardingForm" enctype="multipart/form-data">
            <!-- Personal Information -->
            <div class="form-section">
                <h3 class="section-title">Personal Information</h3>
                <div class="form-row">
                    <div class="form-col">
                        <label for="emp_name" class="required">Full Name</label>
                        <div class="form-group">
                            <input type="text" id="emp_name" name="emp_name" placeholder="Full Name" required maxlength="60" minlength="3">
                            <div id="name-error" class="validation-message">Name must be 3-60 alphabetic characters with single spaces</div>
                        </div>
                    </div>
                    <div class="form-col">
                        <label for="emp_email" class="required">Email Address</label>
                        <div class="form-group">
                            <input type="email" id="emp_email" name="emp_email" placeholder="Email Address" required minlength="5" maxlength="60">
                            <div id="email-error" class="validation-message">Please enter a valid email address</div>
                        </div>
                    </div>
                </div>

                <div class="form-row">
                    <div class="form-col">
                        <label for="emp_dob" class="required">Date of Birth</label>
                        <div class="form-group">
                            <input type="date" id="emp_dob" name="emp_dob" required>
                            <div id="dob-error" class="validation-message">Employee must be at least 20 years old</div>
                        </div>
                    </div>
                    <div class="form-col">
                        <label for="emp_mobile" class="required">Mobile Number (+91)</label>
                        <div class="form-group">
                            <input type="tel" id="emp_mobile" name="emp_mobile" placeholder="Mobile Number" required minlength="10" maxlength="10">
                            <div id="mobile-error" class="validation-message">Please enter a valid 10-digit phone number</div>
                        </div>
                    </div>                  
                </div>

                <div class="form-row">
                    <div class="form-col">
                        <label for="emp_alt_mobile">Alternative Mobile Number (+91)</label>
                        <div class="form-group">
                            <input type="tel" id="emp_alt_mobile" name="emp_alt_mobile" placeholder="Alternative Mobile Number" minlength="10" maxlength="10">
                            <div id="alt-mobile-error" class="validation-message">Please enter a valid 10-digit phone number</div>
                        </div>
                    </div>
                    <div class="form-col">
                        <label for="emp_gender" class="required">Gender</label>
                        <div class="form-group">
                            <select id="emp_gender" name="emp_gender" required>
                                <option value="">Select Gender</option>
                                <option value="Male">Male</option>
                                <option value="Female">Female</option>
                                <option value="Others">Others</option>
                            </select>
                            <div id="gender-error" class="validation-message">Please select a gender</div>
                        </div>
                    </div>
                </div>

                <div class="form-row">
                    <div class="form-col">
                        <label for="emp_marital_status" class="required">Marital Status</label>
                        <div class="form-group">
                            <select id="emp_marital_status" name="emp_marital_status" required>
                                <option value="">Select Marital Status</option>
                                <option value="Single">Single</option>
                                <option value="Married">Married</option>
                                <option value="Divorced">Divorced</option>
                                <option value="Widowed">Widowed</option>
                            </select>
                            <div id="marital-error" class="validation-message">Please select a marital status</div>
                        </div>
                    </div>
                    <div class="form-col">
                        <label for="emp_profile_pic" class="required">Profile Picture</label>
                        <div class="form-group">
                            <input type="file" id="emp_profile_pic" name="emp_profile_pic" accept=".jpg, .png" required>
                            <div id="profile-pic-error" class="validation-message">Please upload a profile picture (JPG/PNG, max 2MB)</div>
                        </div>
                    </div>
                </div>

                <div class="form-row">
                    <div class="form-col">
                        <label for="emp_aadhaar" class="required">Aadhaar Number</label>
                        <div class="form-group">
                            <input type="text" id="emp_aadhaar" name="emp_aadhaar" placeholder="Aadhaar Number" required minlength="12" maxlength="12">
                            <div id="aadhaar-error" class="validation-message">Aadhaar must be exactly 12 digits</div>
                        </div>
                    </div>
                    <div class="form-col">
                        <label for="emp_pan" class="required">PAN Card Number</label>
                        <div class="form-group">
                            <input type="text" id="emp_pan" name="emp_pan" placeholder="PAN Card Number" required minlength="10" maxlength="10">
                            <div id="pan-error" class="validation-message">PAN must be 10 alphanumeric characters (e.g., ABCDE1234F)</div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Emergency Details -->
            <div class="form-section">
                <h3 class="section-title">Emergency Contact Details</h3>
                <h4>Primary Emergency Contact</h4>
                <div class="form-row">
                    <div class="form-col">
                        <label for="primary_contact_name" class="required">Contact Name</label>
                        <div class="form-group">
                            <input type="text" id="primary_contact_name" name="primary_contact_name" placeholder="Contact Name" required minlength="3" maxlength="60">
                            <div id="primary-contact-name-error" class="validation-message">Name must be 3-60 alphabetic characters with single spaces</div>
                        </div>
                    </div>
                    <div class="form-col">
                        <label for="primary_contact_mobile" class="required">Mobile Number (+91)</label>
                        <div class="form-group">
                            <input type="tel" id="primary_contact_mobile" name="primary_contact_mobile" placeholder="Mobile Number" required minlength="10" maxlength="10">
                            <div id="primary-contact-mobile-error" class="validation-message">Please enter a valid 10-digit phone number</div>
                        </div>
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-col">
                        <label for="primary_contact_relation" class="required">Relation</label>
                        <div class="form-group">
                            <select id="primary_contact_relation" name="primary_contact_relation" required>
                                <option value="">Select Relation</option>
                                <option value="Parent">Parent</option>
                                <option value="Spouse">Spouse</option>
                                <option value="Sibling">Sibling</option>
                                <option value="Friend">Friend</option>
                                <option value="Other">Other</option>
                            </select>
                            <div id="primary-contact-relation-error" class="validation-message">Please select a relation</div>
                        </div>
                    </div>
                    <div class="form-col">
                        <label for="primary_contact_email">Email Address</label>
                        <div class="form-group">
                            <input type="email" id="primary_contact_email" name="primary_contact_email" placeholder="Email Address" minlength="5" maxlength="60">
                            <div id="primary-contact-email-error" class="validation-message">Please enter a valid email address</div>
                        </div>
                    </div>
                </div>

                <h4>Secondary Emergency Contact (Optional)</h4>
                <div class="form-row">
                    <div class="form-col">
                        <label for="secondary_contact_name">Contact Name</label>
                        <div class="form-group">
                            <input type="text" id="secondary_contact_name" name="secondary_contact_name" placeholder="Contact Name" minlength="3" maxlength="60">
                            <div id="secondary-contact-name-error" class="validation-message">Name must be 3-60 alphabetic characters with single spaces</div>
                        </div>
                    </div>
                    <div class="form-col">
                        <label for="secondary_contact_mobile">Mobile Number (+91)</label>
                        <div class="form-group">
                            <input type="tel" id="secondary_contact_mobile" name="secondary_contact_mobile" placeholder="Mobile Number" minlength="10" maxlength="10">
                            <div id="secondary-contact-mobile-error" class="validation-message">Please enter a valid 10-digit phone number</div>
                        </div>
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-col">
                        <label for="secondary_contact_relation">Relation</label>
                        <div class="form-group">
                            <select id="secondary_contact_relation" name="secondary_contact_relation">
                                <option value="">Select Relation</option>
                                <option value="Parent">Parent</option>
                                <option value="Spouse">Spouse</option>
                                <option value="Sibling">Sibling</option>
                                <option value="Friend">Friend</option>
                                <option value="Other">Other</option>
                            </select>
                            <div id="secondary-contact-relation-error" class="validation-message">Please select a relation</div>
                        </div>
                    </div>
                    <div class="form-col">
                        <label for="secondary_contact_email">Email Address</label>
                        <div class="form-group">
                            <input type="email" id="secondary_contact_email" name="secondary_contact_email" placeholder="Email Address" minlength="5" maxlength="60">
                            <div id="secondary-contact-email-error" class="validation-message">Please enter a valid email address</div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Address Information -->
            <div class="form-section">
                <h3 class="section-title">Address Information</h3>
                <div class="form-row">
                    <div class="form-col">
                        <label for="emp_address" class="required">Street Address</label>
                        <div class="form-group">
                            <input type="text" id="emp_address" name="emp_address" placeholder="Street Address" required minlength="5" maxlength="80">
                            <div id="address-error" class="validation-message">Address must be 5-80 characters</div>
                        </div>
                    </div>
                    <div class="form-col">
                        <label for="emp_city" class="required">City</label>
                        <div class="form-group">
                            <input type="text" id="emp_city" name="emp_city" placeholder="City" required minlength="3" maxlength="60">
                            <div id="city-error" class="validation-message">Please enter a valid city name</div>
                        </div>
                    </div>
                </div>
                
                <div class="form-row">
                    <div class="form-col">
                        <label for="emp_state" class="required">State</label>
                        <div class="form-group">
                            <select id="emp_state" name="emp_state" required>
                                <option value="">Select State</option>
                                <option value="Andhra Pradesh">Andhra Pradesh</option>
                                <option value="Arunachal Pradesh">Arunachal Pradesh</option>
                                <option value="Assam">Assam</option>
                                <option value="Bihar">Bihar</option>
                                <option value="Chhattisgarh">Chhattisgarh</option>
                                <option value="Goa">Goa</option>
                                <option value="Gujarat">Gujarat</option>
                                <option value="Haryana">Haryana</option>
                                <option value="Himachal Pradesh">Himachal Pradesh</option>
                                <option value="Jharkhand">Jharkhand</option>
                                <option value="Karnataka">Karnataka</option>
                                <option value="Kerala">Kerala</option>
                                <option value="Madhya Pradesh">Madhya Pradesh</option>
                                <option value="Maharashtra">Maharashtra</option>
                                <option value="Manipur">Manipur</option>
                                <option value="Meghalaya">Meghalaya</option>
                                <option value="Mizoram">Mizoram</option>
                                <option value="Nagaland">Nagaland</option>
                                <option value="Odisha">Odisha</option>
                                <option value="Punjab">Punjab</option>
                                <option value="Rajasthan">Rajasthan</option>
                                <option value="Sikkim">Sikkim</option>
                                <option value="Tamil Nadu">Tamil Nadu</option>
                                <option value="Telangana">Telangana</option>
                                <option value="Tripura">Tripura</option>
                                <option value="Uttar Pradesh">Uttar Pradesh</option>
                                <option value="Uttarakhand">Uttarakhand</option>
                                <option value="West Bengal">West Bengal</option>
                                <option value="Andaman and Nicobar Islands">Andaman and Nicobar Islands</option>
                                <option value="Chandigarh">Chandigarh</option>
                                <option value="Dadra and Nagar Haveli and Daman and Diu">Dadra and Nagar Haveli and Daman and Diu</option>
                                <option value="Lakshadweep">Lakshadweep</option>
                                <option value="Delhi">Delhi</option>
                                <option value="Puducherry">Puducherry</option>
                            </select>
                            <div id="state-error" class="validation-message">Please select a state</div>
                        </div>
                    </div>
                    <div class="form-col">
                        <label for="emp_zipcode" class="required">Zip/Postal Code</label>
                        <div class="form-group">
                            <input type="text" id="emp_zipcode" name="emp_zipcode" placeholder="Zip/Postal Code" required minlength="6" maxlength="6">
                            <div id="zipcode-error" class="validation-message">Please enter a valid 6-digit zip code</div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Bank Details -->
            <div class="form-section">
                <h3 class="section-title">Bank Details</h3>
                <div class="form-row">
                    <div class="form-col">
                        <label for="emp_bank" class="required">Bank Name</label>
                        <div class="form-group">
                            <input type="text" id="emp_bank" name="emp_bank" placeholder="Bank Name" required minlength="3" maxlength="60">
                            <div id="bank-error" class="validation-message">Please enter a valid bank name</div>
                        </div>
                    </div>
                    <div class="form-col">
                        <label for="emp_account" class="required">Account Number</label>
                        <div class="form-group">
                            <input type="text" id="emp_account" name="emp_account" placeholder="Account Number" required minlength="9" maxlength="18">
                            <div id="account-error" class="validation-message">Account number must be 9-18 digits</div>
                        </div>
                    </div>
                </div>
                
                <div class="form-row">
                    <div class="form-col">
                        <label for="emp_ifsc" class="required">IFSC Code</label>
                        <div class="form-group">
                            <input type="text" id="emp_ifsc" name="emp_ifsc" placeholder="IFSC Code" required minlength="11" maxlength="11">
                            <div id="ifsc-error" class="validation-message">Please enter a valid IFSC code (e.g. ABCD0123456)</div>
                        </div>
                    </div>
                    <div class="form-col">
                        <label for="emp_bank_branch" class="required">Branch Location</label>
                        <div class="form-group">
                            <input type="text" id="emp_bank_branch" name="emp_bank_branch" placeholder="Branch Location" required minlength="3" maxlength="60">
                            <div id="bank-branch-error" class="validation-message">Please enter a valid branch location</div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Employment Details -->
            <div class="form-section">
                <h3 class="section-title">Employment Details</h3>
                <div class="form-row">
                    <div class="form-col">
                        <label for="emp_job_role" class="required">Job Role</label>
                        <div class="form-group">
                            <select id="emp_job_role" name="emp_job_role" required>
                                <option value="">Select Job Role</option>
                                <option value="Software Developer">Software Developer</option>
                                <option value="Web Developer">Web Developer</option>
                                <option value="Backend Developer">Backend Developer</option>
                                <option value="Software Tester">Software Tester</option>
                                <option value="Java Developer">Java Developer</option>
                                <option value="Python Developer">Python Developer</option>
                                <option value="Cloud Engineer">Cloud Engineer</option>
                                <option value="Data Scientist">Data Scientist</option>
                                <option value="Business Analyst">Business Analyst</option>
                                <option value="DevOps Engineer">DevOps Engineer</option>
                                <option value="Machine Learning Engineer">Machine Learning Engineer</option>
                                <option value="Project Manager">Project Manager</option>
                                <option value="Full Stack Developer">Full Stack Developer</option>
                            </select>
                            <div id="job-error" class="validation-message">Please select a job role</div>
                        </div>
                    </div>
                    <div class="form-col">
                        <label for="emp_department" class="required">Department</label>
                        <div class="form-group">
                            <select id="emp_department" name="emp_department" required>
                                <option value="">Select Department</option>
                                <option value="Engineering">Engineering</option>
                                <option value="Product">Product</option>
                                <option value="Design">Design</option>
                                <option value="Data Science">Data Science</option>
                                <option value="Human Resources">Human Resources</option>
                            </select>
                            <div id="dept-error" class="validation-message">Please select a department</div>
                        </div>
                    </div>
                </div>
                
                <div class="form-row">
                    <div class="form-col">
                        <label class="required">Experience Status</label>
                        <div class="form-group">
                            <select id="emp_experience_status" name="emp_experience_status" required>
                                <option value="">Select Experience</option>
                                <option value="Fresher">Fresher</option>
                                <option value="Experienced">Experienced</option>
                            </select>
                            <div id="exp-status-error" class="validation-message">Please select experience status</div>
                        </div>
                    </div>
                </div>

                <div id="experienceFields" style="display:none;">
                    <p class="form-note">Please enter your most recent experience first.</p>
                    <div id="experienceContainer">
                        <div class="experience-item" id="experience1">
                            <h4>Previous Employment 1 (Most Recent)</h4>
                            <div class="form-row">
                                <div class="form-col">
                                    <label for="emp_company_name_1" class="required">Previous Company Name</label>
                                    <div class="form-group">
                                        <input type="text" id="emp_company_name_1" name="emp_company_name_1" placeholder="Previous Company Name" minlength="3" maxlength="60">
                                        <div id="company-error-1" class="validation-message">Company name must be 3-60 characters</div>
                                    </div>
                                </div>
                                <div class="form-col">
                                    <label for="emp_years_of_experience_1" class="required">Years of Experience</label>
                                    <div class="form-group">
                                        <input type="number" id="emp_years_of_experience_1" name="emp_years_of_experience_1" placeholder="Years of Experience" min="1" max="40" step="0.1">
                                        <div id="exp-years-error-1" class="validation-message">Please enter valid years (1-40)</div>
                                    </div>
                                </div>
                            </div>

                            <div class="form-row">
                                <div class="form-col">
                                    <label for="emp_start_date_1" class="required">Start Date</label>
                                    <div class="form-group">
                                        <input type="date" id="emp_start_date_1" name="emp_start_date_1">
                                        <div id="start-date-error-1" class="validation-message">Start date must be after SSC completion</div>
                                    </div>
                                </div>
                                <div class="form-col">
                                    <label for="emp_end_date_1" class="required">End Date</label>
                                    <div class="form-group">
                                        <input type="date" id="emp_end_date_1" name="emp_end_date_1">
                                        <div id="end-date-error-1" class="validation-message">End date must be after start date and not in the future</div>
                                    </div>
                                </div>
                            </div>

                            <div class="form-row">
                                <div class="form-col">
                                    <label for="emp_uan_1" class="required">UAN Number</label>
                                    <div class="form-group">
                                        <input type="text" id="emp_uan_1" name="emp_uan_1" placeholder="UAN Number" minlength="12" maxlength="12">
                                        <div id="uan-error-1" class="validation-message">UAN must be exactly 12 digits</div>
                                    </div>
                                </div>
                                <div class="form-col">
                                    <label for="emp_pf_1" class="required">PF Number</label>
                                    <div class="form-group">
                                        <input type="text" id="emp_pf_1" name="emp_pf_1" placeholder="PF Number" minlength="17" maxlength="17">
                                        <div id="pf-error-1" class="validation-message">PF number must be 17 alphanumeric characters</div>
                                    </div>
                                </div>
                            </div>

                            <div class="form-row">
                                <div class="form-col">
                                    <label for="emp_offer_letter_1" class="required">Upload Previous Company Offer Letter (PDF only)</label>
                                    <div class="form-group">
                                        <input type="file" id="emp_offer_letter_1" name="emp_offer_letter_1" accept=".pdf">
                                        <div id="offer-letter-error-1" class="validation-message">Please upload your offer letter (PDF only, max 2MB)</div>
                                    </div>
                                </div>
                                <div class="form-col">
                                    <label for="emp_relieving_letter_1" class="required">Upload Relieving Letter (PDF only)</label>
                                    <div class="form-group">
                                        <input type="file" id="emp_relieving_letter_1" name="emp_relieving_letter_1" accept=".pdf">
                                        <div id="relieving-letter-error-1" class="validation-message">Please upload your relieving letter (PDF only, max 2MB)</div>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="form-row">
                                <div class="form-col">
                                    <label for="emp_experience_certificate_1">Upload Experience Certificate (PDF only)</label>
                                    <div class="form-group">
                                        <input type="file" id="emp_experience_certificate_1" name="emp_experience_certificate_1" accept=".pdf">
                                        <div id="experience-cert-error-1" class="validation-message">Please upload your experience certificate (PDF only, max 2MB)</div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <button type="button" id="addExperienceBtn" class="btn btn-primary">Add New Experience</button>
                </div>

                <div class="form-row">
                    <div class="form-col">
                        <label for="emp_joining_date" class="required">Joining Date</label>
                        <div class="form-group">
                            <input type="date" id="emp_joining_date" name="emp_joining_date" required>
                            <div id="joining-error" class="validation-message">Joining date cannot be in the past</div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Education Documents -->
            <div class="form-section">
                <h3 class="section-title">Education Documents</h3>
                
                <div id="educationContainer">
                    <div class="education-item">
                        <h4>SSC (10th Grade)</h4>
                        <div class="form-row">
                            <div class="form-col">
                                <label for="ssc_school" class="required">School Name</label>
                                <div class="form-group">
                                    <input type="text" id="ssc_school" name="ssc_school" required minlength="3" maxlength="60">
                                    <div id="ssc-school-error" class="validation-message">School name must be 3-60 characters</div>
                                </div>
                            </div>
                            <div class="form-col">
                                <label for="ssc_year" class="required">Year of Completion</label>
                                <div class="form-group">
                                    <input type="text" id="ssc_year" name="ssc_year" required maxlength="4">
                                    <div id="ssc-year-error" class="validation-message">Please enter a valid year</div>
                                </div>
                            </div>
                            <div class="form-col">
                                <label for="ssc_grade" class="required">Percentage/CGPA</label>
                                <div class="form-group">
                                    <input type="text" id="ssc_grade" name="ssc_grade" required minlength="1" maxlength="4">
                                    <div id="ssc-grade-error" class="validation-message">Percentage must be 4-100% or 4.0-10.0 for CGPA</div>
                                </div>
                            </div>
                        </div>
                        <!-- SSC Upload Field -->
                        <div class="form-row">
                            <div class="form-col">
                                <label for="emp_ssc_doc" class="required">Upload SSC Certificate (PDF only)</label>
                                <div class="form-group">
                                    <input type="file" id="emp_ssc_doc" name="emp_ssc_doc" required accept=".pdf">
                                    <div id="ssc-error" class="validation-message">Only PDF file (max 2MB)</div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="education-item">
                        <h4>Intermediate/Diploma</h4>
                        <div class="form-row">
                            <div class="form-col">
                                <label for="inter_college" class="required">College Name</label>
                                <div class="form-group">
                                    <input type="text" id="inter_college" name="inter_college" required minlength="3" maxlength="60">
                                    <div id="inter-college-error" class="validation-message">College name must be 3-60 characters</div>
                                </div>
                            </div>
                            <div class="form-col">
                                <label for="inter_year" class="required">Year of Completion</label>
                                <div class="form-group">
                                    <input type="text" id="inter_year" name="inter_year" required maxlength="4">
                                    <div id="inter-year-error" class="validation-message">Please enter a valid year</div>
                                </div>
                            </div>
                            <div class="form-col">
                                <label for="inter_grade" class="required">Percentage/CGPA</label>
                                <div class="form-group">
                                    <input type="text" id="inter_grade" name="inter_grade" required minlength="1" maxlength="4">
                                    <div id="inter-grade-error" class="validation-message">Percentage must be 4-100% or 4.0-10.0 for CGPA</div>
                                </div>
                            </div>
                        </div>
                        <div class="form-row">
                            <div class="form-col">
                                <label for="inter_branch" class="required">Branch/Stream</label>
                                <div class="form-group">
                                    <input type="text" id="inter_branch" name="inter_branch" required minlength="3" maxlength="60">
                                    <div id="inter-branch-error" class="validation-message">Branch must be 3-60 characters</div>
                                </div>
                            </div>
                        </div>
                        <!-- Intermediate Upload Field -->
                        <div class="form-row">
                            <div class="form-col">
                                <label for="emp_inter_doc" class="required">Upload Intermediate Certificate (PDF only)</label>
                                <div class="form-group">
                                    <input type="file" id="emp_inter_doc" name="emp_inter_doc" required accept=".pdf">
                                    <div id="inter-error" class="validation-message">Only PDF file (max 2MB)</div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="education-item">
                        <h4>Graduation</h4>
                        <div class="form-row">
                            <div class="form-col">
                                <label for="grad_college" class="required">University/College Name</label>
                                <div class="form-group">
                                    <input type="text" id="grad_college" name="grad_college" required minlength="3" maxlength="60">
                                    <div id="grad-college-error" class="validation-message">College name must be 3-60 characters</div>
                                </div>
                            </div>
                            <div class="form-col">
                                <label for="grad_year" class="required">Year of Completion</label>
                                <div class="form-group">
                                    <input type="text" id="grad_year" name="grad_year" required maxlength="4">
                                    <div id="grad-year-error" class="validation-message">Please enter a valid year</div>
                                </div>
                            </div>
                            <div class="form-col">
                                <label for="grad_grade" class="required">Percentage/CGPA</label>
                                <div class="form-group">
                                    <input type="text" id="grad_grade" name="grad_grade" required minlength="1" maxlength="4">
                                    <div id="grad-grade-error" class="validation-message">Percentage must be 4-100% or 4.0-10.0 for CGPA</div>
                                </div>
                            </div>
                        </div>
                        <div class="form-row">
                            <div class="form-col">
                                <label for="grad_degree" class="required">Degree</label>
                                <div class="form-group">
                                    <input type="text" id="grad_degree" name="grad_degree" required minlength="3" maxlength="30">
                                    <div id="grad-degree-error" class="validation-message">Degree must be 3-30 characters</div>
                                </div>
                            </div>
                            <div class="form-col">
                                <label for="grad_branch" class="required">Branch/Stream</label>
                                <div class="form-group">
                                    <input type="text" id="grad_branch" name="grad_branch" required minlength="3" maxlength="30">
                                    <div id="grad-branch-error" class="validation-message">Branch must be 3-30 characters</div>
                                </div>
                            </div>
                        </div>
                        <!-- Graduation Upload Field -->
                        <div class="form-row">
                            <div class="form-col">
                                <label for="emp_grad_doc" class="required">Upload Graduation Certificate (PDF only)</label>
                                <div class="form-group">
                                    <input type="file" id="emp_grad_doc" name="emp_grad_doc" required accept=".pdf">
                                    <div id="grad-error" class="validation-message">Only PDF file (max 2MB)</div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <button type="button" id="addEducationBtn" class="btn btn-primary">Add New Education</button>
            </div>

            <!-- Additional Documents -->
            <div class="form-section">
                <h3 class="section-title">Additional Documents</h3>

                <!-- Resume -->
                <div class="form-row">
                    <div class="form-col">
                        <label for="resume" class="required">Upload Resume/CV (PDF only)</label>
                        <div class="form-group">
                            <input type="file" id="resume" name="resume" required accept=".pdf">
                            <div id="resume-error" class="validation-message">Only PDF file (max 2MB)</div>
                        </div>
                    </div>
                </div>

                <!-- ID Proof -->
                <div class="form-row">
                    <div class="form-col">
                        <label for="id_proof" class="required">Upload ID Proof (Aadhaar/PAN/Passport) Only PDF, JPG, or PNG files (max 2MB)</label>
                        <div class="form-group">
                            <input type="file" id="id_proof" name="id_proof" required accept=".pdf,.jpg,.png">
                            <div id="id-proof-error" class="validation-message">Only PDF, JPG, or PNG files (max 2MB)</div>
                        </div>
                    </div>
                </div>

                <!-- Signed Offer Letter -->
                <div class="form-row">
                    <div class="form-col">
                        <label for="signed_document" class="required">Upload Signed Offer Letter (PDF only)</label>
                        <div class="form-group">
                            <input type="file" id="signed_document" name="signed_document" required accept=".pdf">
                            <div id="signed-doc-error" class="validation-message">Only PDF file (max 2MB)</div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="form-group checkbox-group">
                <input type="checkbox" id="emp_terms_accepted" name="emp_terms_accepted" required>
                <label for="emp_terms_accepted" class="required">I certify that the information provided in this form is true and complete to the best of my knowledge. I understand that any false statements or omissions may be grounds for termination of employment. I consent to the processing of my personal data for the purpose of employment and onboarding in accordance with the company's privacy policy.</label>
                <div id="terms-error" class="validation-message">You must accept the terms and conditions</div>
            </div>

            <div class="form-group">
                <button type="submit" id="submitBtn" class="btn btn-primary btn-block">Complete Onboarding</button>
            </div>
        </form>
    </div>
    <script>
document.addEventListener('DOMContentLoaded', function() {
    const SERVER_ENDPOINT = 'http://localhost:3000/save-employee';

    // Updated regex patterns based on requirements
    const nameRegex = /^[A-Za-z]+(?: [A-Za-z]+)*$/; // Letters only, single spaces, no leading/trailing
    const emailRegex = /^[a-zA-Z0-9]+([._-][a-zA-Z0-9]+)*@(gmail|outlook)\.(com|in|org|co)$/;
    const mobileRegex = /^[6789]\d{9}$/;
    const addressRegex = /^[A-Za-z0-9][A-Za-z0-9\s,.\-\/#]+[A-Za-z0-9]$/;
    const cityRegex = /^[A-Za-z]+(?: [A-Za-z]+)*$/;
    const zipRegex = /^[1-9][0-9]{5}$/;
    const bankRegex = /^[A-Za-z]+(?: [A-Za-z]+)*$/;
    const accountRegex = /^(?!0+$)[0-9]{9,18}$/;
    const ifscRegex = /^[A-Z]{4}0[A-Z0-9]{6}$/;
    const bankBranchRegex = /^[A-Za-z]+(?: [A-Za-z]+)*$/;
    const companyRegex = /^[A-Za-z]+(?:[ -][A-Za-z]+)*$/;
    const expYearsRegex = /^(0\.[1-9]|[1-9]|[1-3][0-9]|40)(?:\.[0-9])?$/; // 0.1-40 years
    const uanRegex = /^\d{12}$/;
    const pfRegex = /^[A-Z0-9]{17}$/;
    const schoolRegex = /^[A-Za-z]+(?: [A-Za-z]+)*$/;
    const yearRegex = /^(19|20)\d{2}$/;
    const gradeRegex = /^(?:[4-9]|\d{2}|100)(?:\.\d{1,2})?$/; // 4-100 with optional 1-2 decimals
    const branchRegex = /^[A-Za-z]+(?: [A-Za-z]+)*$/;
    const degreeRegex = /^[A-Za-z]+(?: [A-Za-z]+)*$/;
    const pdfRegex = /\.pdf$/i;
    const imageRegex = /\.(jpg|jpeg|png)$/i;
    const aadhaarRegex = /^\d{12}$/;
    const panRegex = /^[A-Z]{5}[0-9]{4}[A-Z]{1}$/;

    // Get current date in IST (India Standard Time)
    const now = new Date();
    const indiaOffset = 330; // IST is UTC+5:30 (330 minutes)
    const indiaNow = new Date(now.getTime() + (indiaOffset - now.getTimezoneOffset()) * 60000);
    const currentYear = indiaNow.getFullYear();
    
    // Set joining date range (today to 6 months in future)
    const joiningDateInput = document.getElementById('emp_joining_date');
    const sixMonthsLater = new Date(indiaNow);
    sixMonthsLater.setMonth(sixMonthsLater.getMonth() + 6);
    
    joiningDateInput.min = formatDateForInput(indiaNow);
    joiningDateInput.max = formatDateForInput(sixMonthsLater);
    joiningDateInput.value = formatDateForInput(indiaNow);
    
    // Set DOB range (20-60 years)
    const dobInput = document.getElementById('emp_dob');
    const minDobDate = new Date(indiaNow);
    minDobDate.setFullYear(minDobDate.getFullYear() - 60);
    const maxDobDate = new Date(indiaNow);
    maxDobDate.setFullYear(maxDobDate.getFullYear() - 20);
    
    dobInput.max = formatDateForInput(maxDobDate);
    dobInput.min = formatDateForInput(minDobDate);

    // Helper function to format date as YYYY-MM-DD
    function formatDateForInput(date) {
        const d = new Date(date);
        let month = '' + (d.getMonth() + 1);
        let day = '' + d.getDate();
        const year = d.getFullYear();
        
        if (month.length < 2) month = '0' + month;
        if (day.length < 2) day = '0' + day;
        
        return [year, month, day].join('-');
    }
    
    // Function to clean and normalize letter-only fields with better space handling
    function cleanLetterInput(input) {
        let value = input.value;
        
        // Allow typing space between words but prevent leading/trailing/multiple spaces
        if (value.length > 0) {
            // If last character is space and previous character was space, don't allow
            if (value.slice(-1) === ' ' && value.slice(-2, -1) === ' ') {
                value = value.slice(0, -1);
            }
            
            // Remove any non-alphabet characters except single spaces between words
            value = value.replace(/[^A-Za-z ]/g, '')
                        .replace(/^\s+/, '')  // Remove leading spaces
                        .replace(/\s+/g, ' '); // Replace multiple spaces with single
        }
        
        value = value.substring(0, input.maxLength || 60);
        input.value = value;
        return value;
    }

    // Function to clean address field
    function cleanAddressInput(input) {
        let value = input.value;
        
        // Allow typing special characters but clean up
        value = value.replace(/[^A-Za-z0-9\s,.\-\/#]/g, '')
                    .replace(/([.,\-\/#])\1+/g, '$1')
                    .replace(/\s+/g, ' ')
                    .replace(/^\s+/, '')
                    .replace(/\s+$/, '');
        
        value = value.substring(0, input.maxLength || 80);
        input.value = value;
        return value;
    }

    // Function to clean numeric fields
    function cleanNumericInput(input) {
        let value = input.value;
        value = value.replace(/[^0-9]/g, '');
        value = value.substring(0, input.maxLength || 18);
        input.value = value;
        return value;
    }

    // Function to clean email
    function cleanEmail(input) {
        let value = input.value;
        value = value.replace(/\s+/g, '').toLowerCase();
        value = value.substring(0, input.maxLength || 60);
        input.value = value;
        return value;
    }

    // Function to clean IFSC or PF fields
    function cleanCodeInput(input, regex) {
        let value = input.value;
        value = value.replace(/\s+/g, '').toUpperCase();
        value = value.replace(regex, '');
        value = value.substring(0, input.maxLength || 22);
        input.value = value;
        return value;
    }

    // Function to clean percentage/grade fields with percentage display
    function cleanGradeInput(input) {
        let value = input.value.replace(/[^0-9.]/g, ''); // Allow numbers and decimal
        value = value.replace(/(\..*?)\..*/g, '$1');     // Keep only first decimal
        value = value.substring(0, 5);                   // Max 5 chars (e.g., 100.00)
        input.value = value;
        
        // Update percentage display
        const display = input.nextElementSibling;
        if (display && display.classList.contains('percentage-display')) {
            display.textContent = value ? `${value}%` : '';
        }
        return value;
    }

    // Add percentage display to grade inputs
    function addPercentageDisplay(inputId) {
        const input = document.getElementById(inputId);
        if (input) {
            // Check if percentage display already exists
            let display = input.nextElementSibling;
            if (!display || !display.classList.contains('percentage-display')) {
                display = document.createElement('span');
                display.className = 'percentage-display';
                display.style.marginLeft = '5px';
                input.parentNode.insertBefore(display, input.nextSibling);
            }
            
            input.addEventListener('input', function() {
                cleanGradeInput(this);
                validateField(this);
            });
        }
    }

    // Initialize percentage displays for all grade fields
    ['ssc_grade', 'inter_grade', 'grad_grade'].forEach(addPercentageDisplay);

    // Experience fields toggle
    const experienceStatus = document.getElementById('emp_experience_status');
    const experienceFields = document.getElementById('experienceFields');
    
    function toggleExperienceFields() {
        const isExperienced = experienceStatus.value === 'Experienced';
        experienceFields.style.display = isExperienced ? 'block' : 'none';
        
        const experienceFieldsToToggle = [
            'emp_company_name_1', 'emp_years_of_experience_1', 
            'emp_start_date_1', 'emp_end_date_1',
            'emp_uan_1', 'emp_pf_1', 
            'emp_offer_letter_1', 'emp_relieving_letter_1', 
            'emp_experience_certificate_1'
        ];
        
        experienceFieldsToToggle.forEach(fieldId => {
            const field = document.getElementById(fieldId);
            if (field) {
                if (isExperienced) {
                    if (field.type !== 'file' || field.id.includes('offer_letter') || field.id.includes('relieving_letter')) {
                        field.setAttribute('required', '');
                    }
                } else {
                    field.removeAttribute('required');
                    field.value = '';
                    const errorElement = document.getElementById(fieldId.replace(/_\d$/, '-error-1'));
                    if (errorElement) {
                        errorElement.classList.remove('visible');
                        field.classList.remove('invalid', 'valid');
                    }
                }
            }
        });
    }
    
    experienceStatus.addEventListener('change', toggleExperienceFields);
    toggleExperienceFields(); // Initialize on page load

    // Add new experience functionality
    let experienceCount = 1;
    const maxExperiences = 3;
    const addExperienceBtn = document.getElementById('addExperienceBtn');
    const experienceContainer = document.getElementById('experienceContainer');
    const initialExperienceHTML = experienceContainer.innerHTML;

    addExperienceBtn.addEventListener('click', function() {
        if (experienceCount < maxExperiences) {
            experienceCount++;
            const newExperience = document.createElement('div');
            newExperience.className = 'experience-item';
            newExperience.id = `experience${experienceCount}`;
            newExperience.innerHTML = `
                <h4>Previous Employment ${experienceCount}</h4>
                <div class="form-row">
                    <div class="form-col">
                        <label for="emp_company_name_${experienceCount}" class="required">Previous Company Name</label>
                        <div class="form-group">
                            <input type="text" id="emp_company_name_${experienceCount}" name="emp_company_name_${experienceCount}" placeholder="Previous Company Name" minlength="3" maxlength="60" required>
                            <div id="company-error-${experienceCount}" class="validation-message">Company name must be 3-60 characters</div>
                        </div>
                    </div>
                    <div class="form-col">
                        <label for="emp_years_of_experience_${experienceCount}" class="required">Years of Experience</label>
                        <div class="form-group">
                            <input type="text" id="emp_years_of_experience_${experienceCount}" name="emp_years_of_experience_${experienceCount}" placeholder="Years of Experience" required>
                            <div id="exp-years-error-${experienceCount}" class="validation-message">Please enter valid years (0.1-40)</div>
                        </div>
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-col">
                        <label for="emp_start_date_${experienceCount}" class="required">Start Date</label>
                        <div class="form-group">
                            <input type="date" id="emp_start_date_${experienceCount}" name="emp_start_date_${experienceCount}" required>
                            <div id="start-date-error-${experienceCount}" class="validation-message">Start date must be after SSC completion</div>
                        </div>
                    </div>
                    <div class="form-col">
                        <label for="emp_end_date_${experienceCount}" class="required">End Date</label>
                        <div class="form-group">
                            <input type="date" id="emp_end_date_${experienceCount}" name="emp_end_date_${experienceCount}" required>
                            <div id="end-date-error-${experienceCount}" class="validation-message">End date must be at least 1 month after start date and not in the future</div>
                        </div>
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-col">
                        <label for="emp_uan_${experienceCount}" class="required">UAN Number</label>
                        <div class="form-group">
                            <input type="text" id="emp_uan_${experienceCount}" name="emp_uan_${experienceCount}" placeholder="UAN Number" minlength="12" maxlength="12" required>
                            <div id="uan-error-${experienceCount}" class="validation-message">UAN must be exactly 12 digits</div>
                        </div>
                    </div>
                    <div class="form-col">
                        <label for="emp_pf_${experienceCount}" class="required">PF Number</label>
                        <div class="form-group">
                            <input type="text" id="emp_pf_${experienceCount}" name="emp_pf_${experienceCount}" placeholder="PF Number" minlength="17" maxlength="17" required>
                            <div id="pf-error-${experienceCount}" class="validation-message">PF number must be 17 alphanumeric characters</div>
                        </div>
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-col">
                        <label for="emp_offer_letter_${experienceCount}" class="required">Upload Previous Company Offer Letter (PDF only)</label>
                        <div class="form-group">
                            <input type="file" id="emp_offer_letter_${experienceCount}" name="emp_offer_letter_${experienceCount}" accept=".pdf" required>
                            <div id="offer-letter-error-${experienceCount}" class="validation-message">Please upload your offer letter (PDF only, max 2MB)</div>
                        </div>
                    </div>
                    <div class="form-col">
                        <label for="emp_relieving_letter_${experienceCount}" class="required">Upload Relieving Letter (PDF only)</label>
                        <div class="form-group">
                            <input type="file" id="emp_relieving_letter_${experienceCount}" name="emp_relieving_letter_${experienceCount}" accept=".pdf" required>
                            <div id="relieving-letter-error-${experienceCount}" class="validation-message">Please upload your relieving letter (PDF only, max 2MB)</div>
                        </div>
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-col">
                        <label for="emp_experience_certificate_${experienceCount}">Upload Experience Certificate (PDF only)</label>
                        <div class="form-group">
                            <input type="file" id="emp_experience_certificate_${experienceCount}" name="emp_experience_certificate_${experienceCount}" accept=".pdf">
                            <div id="experience-cert-error-${experienceCount}" class="validation-message">Please upload your experience certificate (PDF only, max 2MB)</div>
                        </div>
                    </div>
                </div>
            `;
            experienceContainer.appendChild(newExperience);
            addEventListenersForExperience(experienceCount);
            updateExperienceDateConstraints(experienceCount);
            if (experienceCount === maxExperiences) {
                addExperienceBtn.disabled = true;
            }
        }
    });

    // Add new education functionality
    let educationCount = 3;
    const maxEducations = 5;
    const addEducationBtn = document.getElementById('addEducationBtn');
    const educationContainer = document.getElementById('educationContainer');
    const initialEducationHTML = educationContainer.innerHTML;

    addEducationBtn.addEventListener('click', function() {
        if (educationCount < maxEducations) {
            educationCount++;
            const newEducation = document.createElement('div');
            newEducation.className = 'education-item';
            newEducation.id = `education${educationCount}`;
            newEducation.innerHTML = `
                <h4>Additional Education ${educationCount - 2}</h4>
                <div class="form-row">
                    <div class="form-col">
                        <label for="extra_college_${educationCount}" class="required">University/College Name</label>
                        <div class="form-group">
                            <input type="text" id="extra_college_${educationCount}" name="extra_college_${educationCount}" required minlength="3" maxlength="60">
                            <div id="extra-college-error-${educationCount}" class="validation-message">College name must be 3-60 characters</div>
                        </div>
                    </div>
                    <div class="form-col">
                        <label for="extra_year_${educationCount}" class="required">Year of Completion</label>
                        <div class="form-group">
                            <input type="text" id="extra_year_${educationCount}" name="extra_year_${educationCount}" required maxlength="4">
                            <div id="extra-year-error-${educationCount}" class="validation-message">Please enter a valid year</div>
                        </div>
                    </div>
                    <div class="form-col">
                        <label for="extra_grade_${educationCount}" class="required">Percentage/CGPA</label>
                        <div class="form-group">
                            <input type="text" id="extra_grade_${educationCount}" name="extra_grade_${educationCount}" required minlength="1" maxlength="5">
                            <span class="percentage-display" style="margin-left:5px;"></span>
                            <div id="extra-grade-error-${educationCount}" class="validation-message">Percentage must be 4-100 with up to 2 decimal places</div>
                        </div>
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-col">
                        <label for="extra_degree_${educationCount}" class="required">Degree</label>
                        <div class="form-group">
                            <input type="text" id="extra_degree_${educationCount}" name="extra_degree_${educationCount}" required minlength="3" maxlength="30">
                            <div id="extra-degree-error-${educationCount}" class="validation-message">Degree must be 3-30 characters</div>
                        </div>
                    </div>
                    <div class="form-col">
                        <label for="extra_branch_${educationCount}" class="required">Branch/Stream</label>
                        <div class="form-group">
                            <input type="text" id="extra_branch_${educationCount}" name="extra_branch_${educationCount}" required minlength="3" maxlength="30">
                            <div id="extra-branch-error-${educationCount}" class="validation-message">Branch must be 3-30 characters</div>
                        </div>
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-col">
                        <label for="emp_extra_doc_${educationCount}" class="required">Upload Certificate (PDF only)</label>
                        <div class="form-group">
                            <input type="file" id="emp_extra_doc_${educationCount}" name="emp_extra_doc_${educationCount}" required accept=".pdf">
                            <div id="extra-error-${educationCount}" class="validation-message">Only PDF file (max 2MB)</div>
                        </div>
                    </div>
                </div>
            `;
            educationContainer.appendChild(newEducation);
            addEventListenersForEducation(educationCount);
            addPercentageDisplay(`extra_grade_${educationCount}`);
            if (educationCount === maxEducations) {
                addEducationBtn.disabled = true;
            }
        }
    });

    // Update date constraints for experience fields
    function updateExperienceDateConstraints(index) {
        const startDateInput = document.getElementById(`emp_start_date_${index}`);
        const endDateInput = document.getElementById(`emp_end_date_${index}`);
        const sscYear = document.getElementById('ssc_year').value;

        if (startDateInput && endDateInput) {
            if (sscYear && yearRegex.test(sscYear)) {
                const minStartDate = new Date(parseInt(sscYear) + 1, 0, 1);
                startDateInput.min = formatDateForInput(minStartDate);
            }
            endDateInput.max = formatDateForInput(indiaNow);

            // Ensure start date of new company >= end date of previous
            if (index > 1) {
                const prevEndDateInput = document.getElementById(`emp_end_date_${index - 1}`);
                if (prevEndDateInput.value) {
                    startDateInput.min = prevEndDateInput.value;
                }
            }
        }
    }

    // Add event listeners for new experience fields
    function addEventListenersForExperience(index) {
        const fields = [
            `emp_company_name_${index}`,
            `emp_years_of_experience_${index}`,
            `emp_start_date_${index}`,
            `emp_end_date_${index}`,
            `emp_uan_${index}`,
            `emp_pf_${index}`,
            `emp_offer_letter_${index}`,
            `emp_relieving_letter_${index}`,
            `emp_experience_certificate_${index}`
        ];

        fields.forEach(fieldId => {
            const field = document.getElementById(fieldId);
            if (field) {
                if (field.type !== 'file') {
                    field.addEventListener('input', function() {
                        switch(fieldId) {
                            case `emp_company_name_${index}`:
                                cleanLetterInput(this);
                                break;
                            case `emp_years_of_experience_${index}`:
                                this.value = this.value.replace(/[^0-9.]/g, '')
                                                  .replace(/(\..*?)\..*/g, '$1');
                                break;
                            case `emp_uan_${index}`:
                                cleanNumericInput(this);
                                break;
                            case `emp_pf_${index}`:
                                cleanCodeInput(this, /[^A-Z0-9]/g);
                                break;
                        }
                        validateField(this);
                    });
                    field.addEventListener('blur', function() {
                        validateField(this);
                    });
                    if (field.type === 'date') {
                        field.addEventListener('change', function() {
                            validateField(this);
                            updateExperienceDateConstraints(index);
                        });
                    }
                } else {
                    field.addEventListener('change', function() {
                        switch(fieldId) {
                            case `emp_offer_letter_${index}`:
                                validateOfferLetter(index);
                                break;
                            case `emp_relieving_letter_${index}`:
                                validateRelievingLetter(index);
                                break;
                            case `emp_experience_certificate_${index}`:
                                validateExperienceCertificate(index);
                                break;
                        }
                    });
                }
            }
        });
    }

    // Add event listeners for new education fields
    function addEventListenersForEducation(index) {
        const fields = [
            `extra_college_${index}`,
            `extra_year_${index}`,
            `extra_grade_${index}`,
            `extra_degree_${index}`,
            `extra_branch_${index}`,
            `emp_extra_doc_${index}`
        ];

        fields.forEach(fieldId => {
            const field = document.getElementById(fieldId);
            if (field) {
                if (field.type !== 'file') {
                    field.addEventListener('input', function() {
                        switch(fieldId) {
                            case `extra_college_${index}`:
                            case `extra_degree_${index}`:
                            case `extra_branch_${index}`:
                                cleanLetterInput(this);
                                break;
                            case `extra_year_${index}`:
                                cleanNumericInput(this);
                                break;
                            case `extra_grade_${index}`:
                                cleanGradeInput(this);
                                break;
                        }
                        validateField(this);
                    });
                    field.addEventListener('blur', function() {
                        validateField(this);
                    });
                } else {
                    field.addEventListener('change', function() {
                        validateExtraDoc(index);
                    });
                }
            }
        });
    }

    // Apply event listeners to all inputs for real-time validation
    const allInputs = document.querySelectorAll('input, select, textarea');
    allInputs.forEach(input => {
        if (input.type !== 'file' && input.type !== 'date') {
            input.addEventListener('input', function() {
                switch(this.id) {
                    case 'emp_name':
                    case 'emp_bank':
                    case 'emp_bank_branch':
                    case 'ssc_school':
                    case 'inter_college':
                    case 'grad_college':
                    case 'inter_branch':
                    case 'grad_branch':
                    case 'grad_degree':
                    case 'emp_company_name_1':
                    case 'primary_contact_name':
                    case 'secondary_contact_name':
                        cleanLetterInput(this);
                        break;
                    case 'emp_city':
                        cleanLetterInput(this);
                        break;
                    case 'emp_address':
                        cleanAddressInput(this);
                        break;
                    case 'emp_email':
                    case 'primary_contact_email':
                    case 'secondary_contact_email':
                        cleanEmail(this);
                        break;
                    case 'emp_mobile':
                    case 'emp_alt_mobile':
                    case 'emp_account':
                    case 'emp_uan_1':
                    case 'emp_zipcode':
                    case 'emp_aadhaar':
                    case 'primary_contact_mobile':
                    case 'secondary_contact_mobile':
                        cleanNumericInput(this);
                        break;
                    case 'emp_ifsc':
                    case 'emp_pan':
                    case 'emp_pf_1':
                        cleanCodeInput(this, /[^A-Z0-9]/g);
                        break;
                    case 'ssc_year':
                    case 'inter_year':
                    case 'grad_year':
                        this.value = this.value.replace(/[^0-9]/g, '').substring(0, 4);
                        break;
                    case 'ssc_grade':
                    case 'inter_grade':
                    case 'grad_grade':
                        cleanGradeInput(this);
                        break;
                }
                validateField(this);
            });
            input.addEventListener('blur', function() {
                validateField(this);
            });
        } else if (input.type === 'date') {
            input.addEventListener('change', function() {
                validateField(this);
                if (this.id.startsWith('emp_start_date_') || this.id.startsWith('emp_end_date_')) {
                    const index = this.id.split('_').pop();
                    updateExperienceDateConstraints(index);
                }
            });
        }
    });

    // File input validations
    document.getElementById('emp_profile_pic').addEventListener('change', validateProfilePic);
    document.getElementById('emp_ssc_doc').addEventListener('change', validateSSCDoc);
    document.getElementById('emp_inter_doc').addEventListener('change', validateInterDoc);
    document.getElementById('emp_grad_doc').addEventListener('change', validateGradDoc);
    document.getElementById('resume').addEventListener('change', validateResume);
    document.getElementById('id_proof').addEventListener('change', validateIdProof);
    document.getElementById('signed_document').addEventListener('change', validateSignedDoc);
    document.getElementById('emp_offer_letter_1').addEventListener('change', () => validateOfferLetter(1));
    document.getElementById('emp_relieving_letter_1').addEventListener('change', () => validateRelievingLetter(1));
    document.getElementById('emp_experience_certificate_1').addEventListener('change', () => validateExperienceCertificate(1));

    // Validation functions for file inputs
    function validateProfilePic() {
        const input = document.getElementById('emp_profile_pic');
        const error = document.getElementById('profile-pic-error');
        if (!input.files[0]) {
            markInvalid(input, error, 'Please upload a profile picture (JPG/PNG, max 2MB)');
            return false;
        }
        const file = input.files[0];
        const maxSize = 2 * 1024 * 1024; // 2MB
        if (!imageRegex.test(file.name)) {
            markInvalid(input, error, 'Only JPG or PNG files allowed');
            return false;
        }
        if (file.size > maxSize) {
            markInvalid(input, error, 'File size must not exceed 2MB');
            return false;
        }
        markValid(input, error);
        return true;
    }

    function validateSSCDoc() {
        return validateFile('emp_ssc_doc', 'ssc-error', pdfRegex, 'Only PDF file (max 2MB)');
    }

    function validateInterDoc() {
        return validateFile('emp_inter_doc', 'inter-error', pdfRegex, 'Only PDF file (max 2MB)');
    }

    function validateGradDoc() {
        return validateFile('emp_grad_doc', 'grad-error', pdfRegex, 'Only PDF file (max 2MB)');
    }

    function validateResume() {
        return validateFile('resume', 'resume-error', pdfRegex, 'Only PDF file (max 2MB)');
    }

    function validateIdProof() {
        const input = document.getElementById('id_proof');
        const error = document.getElementById('id-proof-error');
        if (!input.files[0]) {
            markInvalid(input, error, 'Please upload an ID proof (PDF/JPG/PNG, max 2MB)');
            return false;
        }
        const file = input.files[0];
        const maxSize = 2 * 1024 * 1024; // 2MB
        if (!pdfRegex.test(file.name) && !imageRegex.test(file.name)) {
            markInvalid(input, error, 'Only PDF, JPG, or PNG files allowed');
            return false;
        }
        if (file.size > maxSize) {
            markInvalid(input, error, 'File size must not exceed 2MB');
            return false;
        }
        markValid(input, error);
        return true;
    }

    function validateSignedDoc() {
        return validateFile('signed_document', 'signed-doc-error', pdfRegex, 'Only PDF file (max 2MB)');
    }

    function validateOfferLetter(index) {
        return validateFile(`emp_offer_letter_${index}`, `offer-letter-error-${index}`, pdfRegex, 'Please upload your offer letter (PDF only, max 2MB)');
    }

    function validateRelievingLetter(index) {
        return validateFile(`emp_relieving_letter_${index}`, `relieving-letter-error-${index}`, pdfRegex, 'Please upload your relieving letter (PDF only, max 2MB)');
    }

    function validateExperienceCertificate(index) {
        const input = document.getElementById(`emp_experience_certificate_${index}`);
        const error = document.getElementById(`experience-cert-error-${index}`);
        if (!input.files[0]) {
            markValid(input, error);
            return true;
        }
        const file = input.files[0];
        const maxSize = 2 * 1024 * 1024; // 2MB
        if (!pdfRegex.test(file.name)) {
            markInvalid(input, error, 'Only PDF files allowed');
            return false;
        }
        if (file.size > maxSize) {
            markInvalid(input, error, 'File size must not exceed 2MB');
            return false;
        }
        markValid(input, error);
        return true;
    }

    function validateExtraDoc(index) {
        return validateFile(`emp_extra_doc_${index}`, `extra-error-${index}`, pdfRegex, 'Only PDF file (max 2MB)');
    }

    function validateFile(inputId, errorId, regex, errorMessage) {
        const input = document.getElementById(inputId);
        const error = document.getElementById(errorId);
        if (!input.files[0]) {
            markInvalid(input, error, errorMessage);
            return false;
        }
        const file = input.files[0];
        const maxSize = 2 * 1024 * 1024; // 2MB
        if (!regex.test(file.name)) {
            markInvalid(input, error, errorMessage);
            return false;
        }
        if (file.size > maxSize) {
            markInvalid(input, error, 'File size must not exceed 2MB');
            return false;
        }
        markValid(input, error);
        return true;
    }

    // Generic field validation with education year validation
    function validateField(input) {
        const error = document.getElementById(input.id.replace(/_\d$/, '-error') + (input.id.match(/_\d$/) ? input.id.match(/_\d$/)[0] : ''));
        let isValid = true;
        let errorMessage = '';

        if (input.required && !input.value) {
            isValid = false;
            errorMessage = `Please ${input.type === 'select-one' ? 'select' : 'enter'} a ${input.labels[0]?.textContent.toLowerCase() || 'value'}`;
        } else {
            switch(input.id) {
                case 'emp_name':
                case 'primary_contact_name':
                case 'secondary_contact_name':
                    isValid = nameRegex.test(input.value) && input.value.length >= 3 && input.value.length <= 60;
                    errorMessage = 'Name must be 3-60 alphabetic characters with single spaces, no leading/trailing spaces';
                    break;
                case 'emp_email':
                case 'primary_contact_email':
                case 'secondary_contact_email':
                    isValid = input.value ? emailRegex.test(input.value) : true;
                    errorMessage = 'Please enter a valid email address';
                    break;
                case 'emp_mobile':
                case 'emp_alt_mobile':
                case 'primary_contact_mobile':
                case 'secondary_contact_mobile':
                    isValid = input.value ? mobileRegex.test(input.value) : true;
                    errorMessage = 'Please enter a valid 10-digit phone number';
                    break;
                case 'emp_dob':
                    const dob = new Date(input.value);
                    isValid = dob >= new Date(dobInput.min) && dob <= new Date(dobInput.max);
                    errorMessage = 'Employee must be 20-60 years old';
                    break;
                case 'emp_address':
                    isValid = addressRegex.test(input.value) && input.value.length >= 5 && input.value.length <= 80;
                    errorMessage = 'Address must be 5-80 characters';
                    break;
                case 'emp_city':
                    isValid = cityRegex.test(input.value) && input.value.length >= 3 && input.value.length <= 60;
                    errorMessage = 'Please enter a valid city name';
                    break;
                case 'emp_zipcode':
                    isValid = zipRegex.test(input.value);
                    errorMessage = 'Please enter a valid 6-digit zip code';
                    break;
                case 'emp_bank':
                case 'emp_bank_branch':
                    isValid = bankRegex.test(input.value) && input.value.length >= 3 && input.value.length <= 60;
                    errorMessage = input.id === 'emp_bank' ? 'Please enter a valid bank name' : 'Please enter a valid branch location';
                    break;
                case 'emp_account':
                    isValid = accountRegex.test(input.value);
                    errorMessage = 'Account number must be 9-18 digits';
                    break;
                case 'emp_ifsc':
                    isValid = ifscRegex.test(input.value);
                    errorMessage = 'Please enter a valid IFSC code (e.g. ABCD0123456)';
                    break;
                case 'emp_aadhaar':
                    isValid = aadhaarRegex.test(input.value);
                    errorMessage = 'Aadhaar must be exactly 12 digits';
                    break;
                case 'emp_pan':
                    isValid = panRegex.test(input.value);
                    errorMessage = 'PAN must be 10 alphanumeric characters (e.g., ABCDE1234F)';
                    break;
                case 'emp_company_name_1':
                case 'emp_company_name_2':
                case 'emp_company_name_3':
                    isValid = companyRegex.test(input.value) && input.value.length >= 3 && input.value.length <= 60;
                    errorMessage = 'Company name must be 3-60 characters';
                    break;
                case 'emp_years_of_experience_1':
                case 'emp_years_of_experience_2':
                case 'emp_years_of_experience_3':
                    isValid = expYearsRegex.test(input.value);
                    errorMessage = 'Please enter valid years (0.1-40)';
                    break;
                case 'emp_start_date_1':
                case 'emp_start_date_2':
                case 'emp_start_date_3':
                    const startDate = new Date(input.value);
                    const sscYear = document.getElementById('ssc_year').value;
                    if (sscYear && yearRegex.test(sscYear)) {
                        const minStart = new Date(parseInt(sscYear) + 1, 0, 1);
                        isValid = startDate >= minStart;
                        errorMessage = 'Start date must be after SSC completion';
                    }
                    break;
                case 'emp_end_date_1':
                case 'emp_end_date_2':
                case 'emp_end_date_3':
                    const endDate = new Date(input.value);
                    const startId = input.id.replace('end_date', 'start_date');
                    const startDateInput = document.getElementById(startId);
                    if (startDateInput.value) {
                        const startDate = new Date(startDateInput.value);
                        const minEndDate = new Date(startDate);
                        minEndDate.setMonth(minEndDate.getMonth() + 1); // Minimum 1-month gap
                        isValid = endDate >= minEndDate && endDate <= indiaNow;
                        errorMessage = 'End date must be at least 1 month after start date and not in the future';
                    }
                    break;
                case 'emp_uan_1':
                case 'emp_uan_2':
                case 'emp_uan_3':
                    isValid = uanRegex.test(input.value);
                    errorMessage = 'UAN must be exactly 12 digits';
                    break;
                case 'emp_pf_1':
                case 'emp_pf_2':
                case 'emp_pf_3':
                    isValid = pfRegex.test(input.value);
                    errorMessage = 'PF number must be 17 alphanumeric characters';
                    break;
                case 'ssc_school':
                case 'inter_college':
                case 'grad_college':
                case 'extra_college_4':
                case 'extra_college_5':
                    isValid = schoolRegex.test(input.value) && input.value.length >= 3 && input.value.length <= 60;
                    errorMessage = 'School/College name must be 3-60 characters';
                    break;
                case 'ssc_year':
                    const sscYearValue = parseInt(input.value);
                    const dobYear = new Date(document.getElementById('emp_dob').value).getFullYear();
                    isValid = yearRegex.test(input.value) && 
                              sscYearValue >= (dobYear + 12) && 
                              sscYearValue <= currentYear;
                    errorMessage = `SSC year must be valid and at least 12 years after birth year (${dobYear + 12}-${currentYear})`;
                    break;
                case 'inter_year':
                    const interYearValue = parseInt(input.value);
                    const sscYearVal = parseInt(document.getElementById('ssc_year').value);
                    isValid = yearRegex.test(input.value) && 
                              interYearValue >= (sscYearVal + 2) && 
                              interYearValue <= currentYear;
                    errorMessage = `Intermediate year must be valid and at least 2 years after SSC (${sscYearVal + 2}-${currentYear})`;
                    break;
                case 'grad_year':
                    const gradYearValue = parseInt(input.value);
                    const interYearVal = parseInt(document.getElementById('inter_year').value);
                    isValid = yearRegex.test(input.value) && 
                              gradYearValue >= (interYearVal + 3) && 
                              gradYearValue <= (currentYear + 2);
                    errorMessage = `Graduation year must be valid and at least 3 years after Intermediate (${interYearVal + 3}-${currentYear + 2})`;
                    break;
                case 'extra_year_4':
                case 'extra_year_5':
                    const extraYearValue = parseInt(input.value);
                    const prevYearId = input.id === 'extra_year_4' ? 'grad_year' : 'extra_year_4';
                    const prevYearVal = parseInt(document.getElementById(prevYearId).value);
                    isValid = yearRegex.test(input.value) && 
                              extraYearValue >= (prevYearVal + 1) && 
                              extraYearValue <= (currentYear + 2);
                    errorMessage = `Year must be valid and after previous education (${prevYearVal + 1}-${currentYear + 2})`;
                    break;
                case 'ssc_grade':
                case 'inter_grade':
                case 'grad_grade':
                case 'extra_grade_4':
                case 'extra_grade_5':
                    isValid = gradeRegex.test(input.value);
                    errorMessage = 'Percentage must be 4-100 with up to 2 decimal places';
                    break;
                case 'inter_branch':
                case 'grad_branch':
                case 'extra_branch_4':
                case 'extra_branch_5':
                    isValid = branchRegex.test(input.value) && input.value.length >= 3 && input.value.length <= 30;
                    errorMessage = 'Branch must be 3-30 characters';
                    break;
                case 'grad_degree':
                case 'extra_degree_4':
                case 'extra_degree_5':
                    isValid = degreeRegex.test(input.value) && input.value.length >= 3 && input.value.length <= 30;
                    errorMessage = 'Degree must be 3-30 characters';
                    break;
                case 'emp_gender':
                case 'emp_marital_status':
                case 'emp_job_role':
                case 'emp_department':
                case 'emp_experience_status':
                case 'primary_contact_relation':
                case 'secondary_contact_relation':
                case 'emp_state':
                    isValid = input.value !== '';
                    errorMessage = `Please select a ${input.labels[0]?.textContent.toLowerCase() || 'value'}`;
                    break;
                case 'emp_joining_date':
                    const joiningDate = new Date(input.value);
                    isValid = joiningDate >= indiaNow && joiningDate <= new Date(joiningDateInput.max);
                    errorMessage = 'Joining date cannot be in the past';
                    break;
            }
        }

        if (isValid) {
            markValid(input, error);
        } else {
            markInvalid(input, error, errorMessage);
        }
        return isValid;
    }

    // Mark field as valid
    function markValid(input, error) {
        input.classList.remove('invalid');
        input.classList.add('valid');
        if (error) {
            error.classList.remove('visible');
        }
    }

    // Mark field as invalid
    function markInvalid(input, error, message) {
        input.classList.remove('valid');
        input.classList.add('invalid');
        if (error) {
            error.textContent = message;
            error.classList.add('visible');
        }
    }

    // Form submission
    const form = document.getElementById('onboardingForm');
    const submitBtn = document.getElementById('submitBtn');
    const errorSummary = document.getElementById('errorSummary');
    const errorList = document.getElementById('errorList');

    form.addEventListener('submit', async function(e) {
        e.preventDefault();
        submitBtn.disabled = true;
        submitBtn.textContent = 'Submitting...';

        const errors = [];
        const inputs = form.querySelectorAll('input, select, textarea');
        let allValid = true;

        inputs.forEach(input => {
            if (input.required && input.closest('#experienceFields')?.style.display === 'none') {
                return; // Skip validation for hidden experience fields
            }
            if (!validateField(input)) {
                allValid = false;
                errors.push(`${input.labels[0]?.textContent || input.name} is invalid`);
            }
        });

        // Validate file inputs
        const fileInputs = [
            { id: 'emp_profile_pic', validate: validateProfilePic },
            { id: 'emp_ssc_doc', validate: validateSSCDoc },
            { id: 'emp_inter_doc', validate: validateInterDoc },
            { id: 'emp_grad_doc', validate: validateGradDoc },
            { id: 'resume', validate: validateResume },
            { id: 'id_proof', validate: validateIdProof },
            { id: 'signed_document', validate: validateSignedDoc }
        ];

        if (experienceStatus.value === 'Experienced') {
            for (let i = 1; i <= experienceCount; i++) {
                fileInputs.push(
                    { id: `emp_offer_letter_${i}`, validate: () => validateOfferLetter(i) },
                    { id: `emp_relieving_letter_${i}`, validate: () => validateRelievingLetter(i) },
                    { id: `emp_experience_certificate_${i}`, validate: () => validateExperienceCertificate(i) }
                );
            }
        }

        for (let i = 4; i <= educationCount; i++) {
            fileInputs.push({ id: `emp_extra_doc_${i}`, validate: () => validateExtraDoc(i) });
        }

        fileInputs.forEach(fileInput => {
            const input = document.getElementById(fileInput.id);
            if (input && input.closest('#experienceFields')?.style.display !== 'none' && !fileInput.validate()) {
                allValid = false;
                errors.push(`${input.labels[0]?.textContent || input.name} is invalid`);
            }
        });

        // Check terms checkbox
        const terms = document.getElementById('emp_terms_accepted');
        if (!terms.checked) {
            allValid = false;
            errors.push('You must accept the terms and conditions');
            markInvalid(terms, document.getElementById('terms-error'), 'You must accept the terms and conditions');
        } else {
            markValid(terms, document.getElementById('terms-error'));
        }

        // Display errors
        if (!allValid) {
            errorList.innerHTML = errors.map(error => `<li>${error}</li>`).join('');
            errorSummary.classList.add('visible');
            submitBtn.disabled = false;
            submitBtn.textContent = 'Complete Onboarding';
            window.scrollTo(0, 0);
            return;
        }

        errorSummary.classList.remove('visible');

        // Submit form data
        const formData = new FormData(form);
        try {
            const response = await fetch(SERVER_ENDPOINT, {
                method: 'POST',
                body: formData
            });

            // Check if response is JSON
            const contentType = response.headers.get('content-type');
            if (!response.ok) {
                if (contentType && contentType.includes('application/json')) {
                    const errorData = await response.json();
                    throw new Error(errorData.message || `Server error: ${response.status}`);
                } else {
                    const text = await response.text();
                    throw new Error(`Server returned non-JSON response: ${response.status} ${response.statusText}`);
                }
            }

            if (!contentType || !contentType.includes('application/json')) {
                throw new Error('Unexpected response format: Expected JSON');
            }

            const result = await response.json();
            alert('Form submitted successfully!');
            resetForm();
        } catch (error) {
            console.error('Submission error:', error);
            let errorMessage = 'Failed to submit form. Please try again.';
            if (error.message.includes('non-JSON')) {
                errorMessage = 'Server error: Please check if the server is running and configured correctly.';
            } else if (error.message.includes('Unexpected response format')) {
                errorMessage = 'Server error: Invalid response format received.';
            }
            errorList.innerHTML = `<li>${errorMessage}</li>`;
            errorSummary.classList.add('visible');
            window.scrollTo(0, 0);
        } finally {
            submitBtn.disabled = false;
            submitBtn.textContent = 'Complete Onboarding';
        }
    });

    // Reset form
    function resetForm() {
        form.reset();
        experienceCount = 1;
        educationCount = 3;
        experienceContainer.innerHTML = initialExperienceHTML;
        educationContainer.innerHTML = initialEducationHTML;
        addExperienceBtn.disabled = false;
        addEducationBtn.disabled = false;
        toggleExperienceFields();
        joiningDateInput.value = formatDateForInput(indiaNow);
        document.querySelectorAll('.validation-message').forEach(el => el.classList.remove('visible'));
        document.querySelectorAll('.valid, .invalid').forEach(el => {
            el.classList.remove('valid', 'invalid');
        });
        document.querySelectorAll('.percentage-display').forEach(el => el.textContent = '');
        ['ssc_grade', 'inter_grade', 'grad_grade'].forEach(addPercentageDisplay);
        errorSummary.classList.remove('visible');
        addEventListenersForExperience(1);
    }

    // Add event listeners for education year dependencies
    document.getElementById('emp_dob').addEventListener('change', function() {
        validateField(document.getElementById('ssc_year'));
    });

    document.getElementById('ssc_year').addEventListener('change', function() {
        validateField(document.getElementById('inter_year'));
    });

    document.getElementById('inter_year').addEventListener('change', function() {
        validateField(document.getElementById('grad_year'));
    });

    document.getElementById('grad_year').addEventListener('change', function() {
        if (educationCount >= 4) validateField(document.getElementById('extra_year_4'));
    });

    document.getElementById('extra_year_4').addEventListener('change', function() {
        if (educationCount >= 5) validateField(document.getElementById('extra_year_5'));
    });
});
    </script>
</body>
</html>